<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Microcontroller Serial Interface</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
  #inputField { width: 100%; box-sizing: border-box; }
  #output { height: 300px; overflow-y: scroll; background: #f0f0f0; margin-top: 10px; padding: 5px; }
  button { margin-top: 5px; }
</style>
</head>
<body>
  <input type="text" id="inputField" placeholder="Type here...">
  <button onclick="submitData()">Submit</button>
  <button onclick="clearOutput()">Clear Output</button>
  <div id="output"></div>

<script>
  var inputField = document.getElementById('inputField');
  var output = document.getElementById('output');
  var history = [];
  var historyIndex = 0;

  inputField.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      submitData();
    } else if (e.key === 'ArrowUp') {
      historyIndex = Math.max(historyIndex - 1, 0);
      inputField.value = history[historyIndex] || '';
    } else if (e.key === 'ArrowDown') {
      historyIndex = Math.min(historyIndex + 1, history.length - 1);
      inputField.value = history[historyIndex] || '';
    }
  });

  function submitData() {
    var data = inputField.value;
    history.push(data);
    historyIndex = history.length;
    fetch('/submit', { method: 'POST', body: data });
    inputField.value = '';
  }

  function clearOutput() {
    output.innerHTML = '';
  }

  function poll() {
    fetch('/poll')
      .then(response => response.json())
      .then(data => {
        data.forEach(line => {
          var div = document.createElement('div');
          div.textContent = line;
          output.appendChild(div);
        });
      });
  }

  setInterval(poll, 2000); // Poll every 2 seconds
</script>
</body>
</html>
